Проект состоит из нескольких сервисов, упакованных в docker-compose. 
Чтобы развернуть его локально, необходимо склонировать репозиторий и запустить docker-compose
```bash
git clone https://github.com/buc-a/o11y
cd o11y
docker compose up
```
**Основной сервис - Python-бэкенд FastAPI.** Временно доступен по адресу http://158.160.45.39:8000. Предназначен для ведения журнала успеваемости студентов. Имеет ручки для добавления/просмотра студентов, их оценок и предметов. Документация представлена по адресу  http://158.160.45.39:8000/docs. Для того, чтобы приложение отдавало метрики использовалась библиотека *prometheus_fastapi_instrumentator*

**База данных - PostgreSQL.** Для того, чтобы можно было получать метрики от базы, использовался дополнительный сервис - **postgres-exporter**. Метрики доступны по адресу  http://158.160.45.39:9187/metrics. 

**Сбор метрик - Prometheus**. 

**Нагрузка сервисов - Locust**. Доступен по адресу http://158.160.45.39:8089. Нагрузка здесь регулируется кол-вом пользователей, отправляющих запросы. Для удобства в его коде указано, что "тестовый" пользователь будет отсылать новый запрос через секунду после получения ответа от сервера. Поэтому при хорошем соединении кол-во пользователей примерно равно  RPS. Реальные RPS и задержки ответов видны в графическом интерфейсе Locust. 
Для упрощения использовалась нагрузка только на одну ручку сервиса - GET /students/, выполняющую SELECT запрос в БД
![[Pasted image 20250726174422.png]]
**Графическое отображение и алерты - Grafana**. Доступно по адресу http://158.160.45.39:3000 логин: admin, пароль: admin_pass. Здесь есть 2 дашборда: для базы данных и сервиса, а также 2 правила для уведомления: когда задержка более 0.5 секунд на 99 перцентиле и когда RPS превышает 100. Файлы конфигураций лежат для дашбордов, алертов, источника данных (prometheus) и телеграм-бота расположены в директории grafana в соответствующих под-директориях. 

Дашборд базы данных: сведения о транзациях, типах операций, использовании памяти и процессора, константных значений в конфигурации кластера
![[Pasted image 20250726175439.png]]
![[Pasted image 20250726175348.png]]


Дашборд основного сервиса: медианное значение времени обработки запроса, 99 перцентиль, RPS
![[Pasted image 20250726175540.png]]

Чтобы получить уведомления в канал, можно в Locust указать 200 пользователь, скорость их роста не важна.